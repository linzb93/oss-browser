---
description: 
globs: 
alwaysApply: false
---
# 测试规范指南

## 测试框架和工具
- Vitest 用于单元测试和组件测试
- Playwright 用于 E2E 测试
- Vue Test Utils 用于 Vue 组件测试
- Testing Library 用于 DOM 测试

## 测试文件组织
- 单元测试文件使用 `.spec.ts` 后缀
- E2E 测试文件使用 `.e2e.ts` 后缀
- 测试文件与源文件同目录
- 测试工具和 Mock 放在 `tests/utils` 目录

## 单元测试规范

### 命名规范
```typescript
/**
 * 测试套件命名规范
 */
describe('UserService', () => {
  /**
   * 测试用例命名规范
   * 格式：should + 预期行为 + when + 条件
   */
  it('should return user info when given valid id', () => {
    // ...
  });
});
```

### 组件测试示例
```typescript
/**
 * Vue 组件测试示例
 */
describe('UserProfile.vue', () => {
  it('should render user name when props are provided', () => {
    const wrapper = mount(UserProfile, {
      props: {
        username: 'test'
      }
    });
    expect(wrapper.text()).toContain('test');
  });
});
```

### Mock 示例
```typescript
/**
 * 服务 Mock 示例
 */
vi.mock('@/services/api', () => ({
  getUserInfo: vi.fn().mockResolvedValue({
    id: 1,
    name: 'test'
  })
}));
```

## E2E 测试规范

### 页面对象模式
```typescript
/**
 * 页面对象定义
 */
class LoginPage {
  /** 获取用户名输入框 */
  async getUsernameInput() {
    return page.getByLabel('用户名');
  }

  /** 执行登录操作 */
  async login(username: string, password: string) {
    await this.getUsernameInput().fill(username);
    await page.getByLabel('密码').fill(password);
    await page.getByRole('button', { name: '登录' }).click();
  }
}
```

## 测试覆盖率要求
- 单元测试覆盖率 > 80%
- 组件测试覆盖率 > 70%
- 关键业务流程 E2E 测试覆盖率 100%

## 最佳实践
- 使用 AAA (Arrange-Act-Assert) 模式
- 每个测试只测试一个概念
- 避免测试实现细节
- 使用有意义的测试数据
- 保持测试独立性
- 适当使用测试钩子 (beforeEach/afterEach)

## CI/CD 集成
- 提交前运行单元测试
- PR 时运行所有测试
- 定期运行 E2E 测试
- 生成测试覆盖率报告
- 测试失败阻止合并
